# Boostly API - Test Cases Documentation

This document provides detailed instructions on how to test each feature of the Boostly application.

## Prerequisites

1. Ensure the application is running:
   ```bash
   cd src
   uvicorn main:app --reload
   ```

2. The API should be accessible at `http://localhost:8000`

3. You can use cURL, Postman, or the Swagger UI at `http://localhost:8000/docs` for testing

---

## Test Case 1: Student Management

### 1.1 Create Students

**Purpose**: Test creating new students with initial credit balance of 100.

**Steps**:
1. Create Student 1:
   ```bash
   curl -X POST "http://localhost:8000/students" \
     -H "Content-Type: application/json" \
     -d '{"name": "Alice", "email": "alice@example.com"}'
   ```
   **Expected Result**: Student created with `id: 1`, `current_balance: 100`, `monthly_sending_limit: 100`

2. Create Student 2:
   ```bash
   curl -X POST "http://localhost:8000/students" \
     -H "Content-Type: application/json" \
     -d '{"name": "Bob", "email": "bob@example.com"}'
   ```
   **Expected Result**: Student created with `id: 2`, `current_balance: 100`, `monthly_sending_limit: 100`

3. Create Student 3:
   ```bash
   curl -X POST "http://localhost:8000/students" \
     -H "Content-Type: application/json" \
     -d '{"name": "Charlie", "email": "charlie@example.com"}'
   ```
   **Expected Result**: Student created with `id: 3`, `current_balance: 100`, `monthly_sending_limit: 100`

4. Try to create duplicate email:
   ```bash
   curl -X POST "http://localhost:8000/students" \
     -H "Content-Type: application/json" \
     -d '{"name": "Alice Duplicate", "email": "alice@example.com"}'
   ```
   **Expected Result**: Error 400 - "Student with this email already exists"

### 1.2 Get Student Information

**Steps**:
```bash
curl -X GET "http://localhost:8000/students/1"
```

**Expected Result**: Returns student details with current balance and sending limit

---

## Test Case 2: Recognition Feature

### 2.1 Basic Recognition (Send Credits)

**Purpose**: Test sending credits from one student to another.

**Steps**:
1. Alice sends 20 credits to Bob:
   ```bash
   curl -X POST "http://localhost:8000/recognitions?sender_id=1" \
     -H "Content-Type: application/json" \
     -d '{"receiver_id": 2, "credits": 20, "message": "Great work on the project!"}'
   ```
   **Expected Result**: 
   - Recognition created successfully
   - Alice's balance: 80 (100 - 20)
   - Bob's balance: 120 (100 + 20)

2. Verify balances:
   ```bash
   curl -X GET "http://localhost:8000/students/1"
   curl -X GET "http://localhost:8000/students/2"
   ```

### 2.2 Self-Recognition Prevention

**Purpose**: Test that students cannot send credits to themselves.

**Steps**:
```bash
curl -X POST "http://localhost:8000/recognitions?sender_id=1" \
  -H "Content-Type: application/json" \
  -d '{"receiver_id": 1, "credits": 10, "message": "Self recognition"}'
```

**Expected Result**: Error 400 - "Students cannot send credits to themselves"

### 2.3 Insufficient Balance Check

**Purpose**: Test that students cannot send more credits than they have.

**Steps**:
1. Alice (balance: 80) tries to send 100 credits:
   ```bash
   curl -X POST "http://localhost:8000/recognitions?sender_id=1" \
     -H "Content-Type: application/json" \
     -d '{"receiver_id": 2, "credits": 100, "message": "Too many credits"}'
   ```
   **Expected Result**: Error 400 - "Insufficient balance. Current balance: 80, requested: 100"

### 2.4 Monthly Sending Limit

**Purpose**: Test that students cannot exceed monthly sending limit of 100 credits.

**Steps**:
1. Alice sends 50 credits to Bob:
   ```bash
   curl -X POST "http://localhost:8000/recognitions?sender_id=1" \
     -H "Content-Type: application/json" \
     -d '{"receiver_id": 2, "credits": 50, "message": "First batch"}'
   ```
   **Expected Result**: Success (Alice's balance: 30, monthly sent: 70)

2. Alice tries to send 50 more credits:
   ```bash
   curl -X POST "http://localhost:8000/recognitions?sender_id=1" \
     -H "Content-Type: application/json" \
     -d '{"receiver_id": 3, "credits": 50, "message": "Second batch"}'
   ```
   **Expected Result**: Error 400 - "Monthly sending limit exceeded. Limit: 100, already sent: 70, requested: 50"

### 2.5 Get Recognition

**Steps**:
```bash
curl -X GET "http://localhost:8000/recognitions/1"
```

**Expected Result**: Returns recognition details with endorsement count

### 2.6 Get All Recognitions

**Steps**:
```bash
curl -X GET "http://localhost:8000/recognitions"
```

**Expected Result**: Returns list of all recognitions

---

## Test Case 3: Endorsements Feature

### 3.1 Create Endorsement

**Purpose**: Test endorsing (liking) a recognition.

**Steps**:
1. Charlie endorses Alice's recognition to Bob:
   ```bash
   curl -X POST "http://localhost:8000/endorsements?endorser_id=3" \
     -H "Content-Type: application/json" \
     -d '{"recognition_id": 1}'
   ```
   **Expected Result**: Endorsement created successfully

2. Verify endorsement count:
   ```bash
   curl -X GET "http://localhost:8000/recognitions/1"
   ```
   **Expected Result**: `endorsement_count: 1`

### 3.2 Duplicate Endorsement Prevention

**Purpose**: Test that each endorser can only endorse a recognition once.

**Steps**:
1. Charlie tries to endorse the same recognition again:
   ```bash
   curl -X POST "http://localhost:8000/endorsements?endorser_id=3" \
     -H "Content-Type: application/json" \
     -d '{"recognition_id": 1}'
   ```
   **Expected Result**: Error 400 - "You have already endorsed this recognition"

2. Bob can still endorse (different endorser):
   ```bash
   curl -X POST "http://localhost:8000/endorsements?endorser_id=2" \
     -H "Content-Type: application/json" \
     -d '{"recognition_id": 1}'
   ```
   **Expected Result**: Success (endorsement_count should be 2)

### 3.3 Multiple Endorsements

**Purpose**: Test that multiple students can endorse the same recognition.

**Steps**:
1. Create multiple recognitions
2. Have different students endorse them
3. Check endorsement counts

**Expected Result**: Each recognition shows correct endorsement count

---

## Test Case 4: Redemption Feature

### 4.1 Basic Redemption

**Purpose**: Test redeeming credits for vouchers (₹5 per credit).

**Steps**:
1. Bob (balance: 120) redeems 50 credits:
   ```bash
   curl -X POST "http://localhost:8000/redemptions?student_id=2" \
     -H "Content-Type: application/json" \
     -d '{"credits_redeemed": 50}'
   ```
   **Expected Result**: 
   - Redemption created successfully
   - `voucher_amount: 250` (50 * 5)
   - Bob's balance: 70 (120 - 50)

2. Verify Bob's balance:
   ```bash
   curl -X GET "http://localhost:8000/students/2"
   ```
   **Expected Result**: `current_balance: 70`

### 4.2 Insufficient Balance for Redemption

**Purpose**: Test that students cannot redeem more credits than they have.

**Steps**:
1. Bob (balance: 70) tries to redeem 100 credits:
   ```bash
   curl -X POST "http://localhost:8000/redemptions?student_id=2" \
     -H "Content-Type: application/json" \
     -d '{"credits_redeemed": 100}'
   ```
   **Expected Result**: Error 400 - "Insufficient balance. Current balance: 70, requested: 100"

### 4.3 Multiple Redemptions

**Purpose**: Test that students can make multiple redemptions.

**Steps**:
1. Bob redeems 20 more credits:
   ```bash
   curl -X POST "http://localhost:8000/redemptions?student_id=2" \
     -H "Content-Type: application/json" \
     -d '{"credits_redeemed": 20}'
   ```
   **Expected Result**: Success, voucher_amount: 100, balance: 50

2. Get all redemptions for Bob:
   ```bash
   curl -X GET "http://localhost:8000/students/2/redemptions"
   ```
   **Expected Result**: Returns list of all redemptions made by Bob

### 4.4 Verify Credits are Permanently Deducted

**Purpose**: Test that redeemed credits are permanently removed from balance.

**Steps**:
1. Note Bob's balance before redemption
2. Make a redemption
3. Check balance after redemption
4. Verify balance decreased by exact redemption amount

**Expected Result**: Credits are permanently deducted and cannot be recovered

---

## Test Case 5: Credit Reset Mechanism (Step-Up Challenge)

### 5.1 Automatic Monthly Reset

**Purpose**: Test automatic credit reset at the start of a new month.

**Steps**:
1. Set up a student with some balance (e.g., 30 credits remaining)
2. Manually trigger reset (for testing):
   ```bash
   curl -X POST "http://localhost:8000/credits/reset"
   ```
   **Expected Result**: Credits reset to 100 (or 100 + carry-forward if applicable)

**Note**: In production, reset happens automatically when month changes.

### 5.2 Carry-Forward Mechanism

**Purpose**: Test that up to 50 unused credits can be carried forward.

**Steps**:
1. Create a student and ensure they have 30 credits remaining
2. Trigger credit reset
3. Check new balance

**Expected Result**: 
- If student had 30 credits: New balance = 100 + 30 = 130
- If student had 60 credits: New balance = 100 + 50 = 150 (max carry-forward is 50)
- If student had 10 credits: New balance = 100 + 10 = 110

### 5.3 Monthly Sending Limit Reset

**Purpose**: Test that monthly sending limit resets with credits.

**Steps**:
1. Use up monthly sending limit (send 100 credits)
2. Trigger credit reset
3. Try to send credits again

**Expected Result**: Monthly sending limit resets to 100, student can send again

---

## Test Case 6: Leaderboard Feature (Step-Up Challenge)

### 6.1 Basic Leaderboard

**Purpose**: Test leaderboard ranking by total credits received.

**Steps**:
1. Create multiple recognitions:
   - Alice sends 30 credits to Bob
   - Charlie sends 50 credits to Bob
   - Alice sends 20 credits to Charlie
   - Bob sends 10 credits to Charlie

2. Get leaderboard:
   ```bash
   curl -X GET "http://localhost:8000/leaderboard?limit=5"
   ```

**Expected Result**: 
- Bob ranked #1 (received 80 credits: 30 + 50)
- Charlie ranked #2 (received 30 credits: 20 + 10)
- Includes total recognitions and endorsements received

### 6.2 Tie-Breaking by Student ID

**Purpose**: Test that students with same credits are ranked by ID (ascending).

**Steps**:
1. Ensure two students have the same total credits received
2. Get leaderboard

**Expected Result**: Student with lower ID appears first

### 6.3 Leaderboard with Endorsements

**Purpose**: Test that leaderboard includes endorsement counts.

**Steps**:
1. Create recognitions
2. Add endorsements to recognitions
3. Get leaderboard

**Expected Result**: Leaderboard shows total endorsements received across all recognitions

### 6.4 Leaderboard Limit Parameter

**Purpose**: Test that limit parameter controls number of results.

**Steps**:
1. Get leaderboard with limit=3:
   ```bash
   curl -X GET "http://localhost:8000/leaderboard?limit=3"
   ```
2. Get leaderboard with limit=10:
   ```bash
   curl -X GET "http://localhost:8000/leaderboard?limit=10"
   ```

**Expected Result**: Returns exactly the specified number of top students

---

## Test Case 7: Complete Workflow

**Purpose**: Test a complete end-to-end workflow.

**Steps**:
1. **Setup**: Create 3 students (Alice, Bob, Charlie)

2. **Recognition**: 
   - Alice sends 30 credits to Bob with message "Great work!"
   - Bob sends 20 credits to Charlie with message "Well done!"

3. **Endorsements**:
   - Charlie endorses Alice's recognition to Bob
   - Alice endorses Bob's recognition to Charlie

4. **Redemption**:
   - Bob redeems 25 credits (should get ₹125 voucher)
   - Charlie redeems 10 credits (should get ₹50 voucher)

5. **Leaderboard**:
   - Check leaderboard to see rankings

6. **Verification**:
   - Check all balances
   - Check all recognitions
   - Check all redemptions

**Expected Result**: All operations complete successfully, balances are correct, leaderboard reflects accurate data

---

## Test Case 8: Edge Cases

### 8.1 Zero Credits

**Purpose**: Test behavior when student has 0 credits.

**Steps**:
1. Create student and use all credits
2. Try to send more credits
3. Try to redeem credits

**Expected Result**: Appropriate error messages for insufficient balance

### 8.2 Maximum Monthly Limit

**Purpose**: Test sending exactly 100 credits in a month.

**Steps**:
1. Send multiple recognitions totaling exactly 100 credits
2. Try to send one more credit

**Expected Result**: First 100 credits succeed, next credit fails with limit error

### 8.3 Invalid IDs

**Purpose**: Test error handling for non-existent resources.

**Steps**:
1. Try to get student with invalid ID
2. Try to create recognition with invalid sender/receiver ID
3. Try to create endorsement with invalid recognition ID

**Expected Result**: All return 404 Not Found errors

---

## Testing Tips

1. **Use Swagger UI**: Visit `http://localhost:8000/docs` for interactive API testing
2. **Check Database**: You can inspect `src/boostly.db` using SQLite tools
3. **Reset Database**: Delete `src/boostly.db` to start fresh
4. **Test Credit Reset**: Use `/credits/reset` endpoint to manually test reset logic
5. **Verify Balances**: Always check student balances after operations to ensure correctness

---

## Expected Test Results Summary

After running all test cases, you should verify:

- Students can be created with initial 100 credits
- Students can send credits to others (not themselves)
- Monthly sending limit of 100 credits is enforced
- Students cannot send more than their balance
- Endorsements can be created (one per endorser per recognition)
- Credits can be redeemed at ₹5 per credit
- Redeemed credits are permanently deducted
- Credits reset monthly with carry-forward (max 50)
- Leaderboard ranks students by credits received
- All error cases return appropriate HTTP status codes

